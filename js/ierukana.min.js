var ImasCg=ImasCg?ImasCg:{};ImasCg.Ierukana=function(){var a="http://marsa746079.github.io/ierukana/",b={full_name:1,full_name_kana:2,first_name:4,first_name_kana:8,last_name:16,last_name_kana:32},c={gameStart:"ゲーム開始",giveUp:"降参"},d={gameClear:"ゲームクリア！",alreadyAnswer:"その子はもう解答済みです。",notExist:"該当する名前が見つかりません。"},e=["cu","co","pa"],f=10,g={all:0,cu:0,co:0,pa:0},h={all:0,cu:0,co:0,pa:0},i=null,j=null,k=null,l=null,m=null,o=function(a,c){var d=[];return $.each(jsonData.idols,function(e,f){$.each(b,function(b,e){c&e&&f[b].replace("・","")===a&&d.push(f)})}),d},p=function(a){var b=0;return $.each(jsonData.idols,function(c,d){d.attr===a&&b++}),b},q=function(){$("#num-of-remain").text(h.all),$.each(e,function(a,b){$("#"+b+"-idols span.remain").text("あと"+h[b]+"人")})},r=function(){$("#result-tweet-btn").remove(),B(),$("#difficulty-select").fadeOut("fast",function(){$("#difficulty-show").text($("#radio-"+j+" label").text())}),h=$.extend(!0,{},g),$.each(e,function(a,b){C(b)}),q()},s=function(){clearInterval(l),$("#answer-btn").prop("disabled","false"),$("#game-start-btn").removeClass("btn-danger").addClass("btn-success").val(c.gameStart),$("#game-start-btn").after($('<input type="button" id="result-tweet-btn" value="結果をツイート" class="btn btn-info">')),$("#difficulty-select").show(),$("#difficulty-show").text("")},t=function(){$.each(jsonData.idols,function(a,b){b.answered||$("#"+b.id).addClass("giveUp").text(b.full_name)}),s()},u=function(){alert(d.gameClear),s()},v=function(a){return $("#game-start-btn").val(a).prop("disabled","false"),0==a?void w():void setTimeout(function(){v(a-1)},1e3)},w=function(){$("#game-start-btn").removeClass("btn-success").addClass("btn-danger").prop("disabled","").val(c.giveUp),$("#answer-btn").prop("disabled",""),k=parseInt(new Date/1),l=setInterval(function(){x(k)},10)},x=function(){var a=parseInt(new Date/1),b=(a-k)%6e4,c=(a-k)/6e4,d=b/1e3,e=Math.floor(100*d)%100;d=Math.floor(d),c=Math.floor(c),$("#timer-area").html(("00"+c).slice(-3)+":"+("0"+d).slice(-2)+":"+("0"+e).slice(-2))},y=function(){var b=$("#timer-area").text();b=b.replace(":","分"),b=b.replace(":","秒");var c="";if(0==h.all){var d={easy:"アイドルマスター",normal:"アイドルマスター☆",hard:"アイドルマスター☆☆"};c="あなたは "+b+" でアイドル"+g.all+"人の名前を全て言えた"+d[j]+"です。最後に言ったアイドルは"+m+"です。"}else{var e=jsonData.idols.filter(function(a){return!a.answered}),f=e[Math.floor(Math.random()*(e.length-1))];c="あなたは "+b+" かけて"+(g.all-h.all)+"人のアイドルを言うことができました。"+f.full_name+" 等、"+h.all+"人の名前を言えませんでした。精進しましょう。"}var i="https://twitter.com/intent/tweet?hashtags=シンデレラガールズ言えるかな&text=";i=i+c+a,window.open(encodeURI(i))},z=function(){var a=$("#answer-text").val();a=a.replace("・","");var b=o(a,i);if(b.length>0){var c=b.filter(function(a){return!a.answered});if(c.length>0){var e=c[0];$("#"+e.id).addClass("answered").text(e.full_name),e.answered=!0,m=e.full_name,h.all-=1,h[e.attr]-=1,q(),$("#answer-text").val(""),$("#message-area").text(""),0==h.all&&u()}else $("#message-area").text(d.alreadyAnswer)}else $("#message-area").text(d.notExist)},A=function(){var a=$("#game-start-btn");if(a.hasClass("btn-success"))r(),v(3);else if(a.hasClass("btn-danger"))return void t()},B=function(){switch(j=$('input[name="difficulty-radio"]:checked').val(),i=0,j){case"easy":i=i|b.first_name|b.first_name_kana|b.last_name|b.last_name_kana;case"normal":i|=b.full_name_kana;case"hard":i|=b.full_name}},C=function(a){var b="#"+a+"-idols";$(b+" span.remain").text("あと"+h[a]+"人"),$(b+" tbody").html("");var c=$("<tr></tr>"),d=0,e=function(){$(b+" tbody").append(c.clone()),c=$("<tr></tr>"),d=0};$.each(jsonData.idols,function(b,g){if(g.answered=!1,g.attr===a){var h=$('<td id="'+g.id+'">&nbsp;</td>');c.append(h.clone()),d++,d==f&&e()}}),0!=d&&e()};return{init:function(){jsonData=null;var a=function(){g.all=jsonData.idols.length,h.all=g.all,$.each(e,function(a,b){g[b]=p(b),h[b]=g[b],C(b)}),$(".numOfIdol").text(g.all),$("#num-of-remain").text(g.all),$("#answer-text").on("keypress",function(a){13==a.which&&z()}),$("#answer-btn").on("click",function(){z()}),$("#game-start-btn").on("click",function(){A()}),$("#answer-area").on("click","#result-tweet-btn",function(){y()})};$.getJSON("data/idols.json").done(function(b){jsonData=b,a()}).fail(function(a){$("#message-area").text("データ読み込みエラー")})}}}(),$(function(){ImasCg.Ierukana.init()});